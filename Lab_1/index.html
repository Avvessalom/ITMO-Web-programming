<!DOCTYPE html>
<html lang="en" xmlns:https="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Lab_1</title>
    <link rel="stylesheet" href="assets/css/style'.css">
    <link href="https://fonts.googleapis.com/css?family=Pacifico&display=swap&subset=cyrillic,cyrillic-ext" rel="stylesheet">
</head>
<body>
<script src="jquery-3.4.1.js"></script>

<script>
    const checkArea = function(){
        let yStr = $("#y-value-select").val().replace(",",".");
        let xValue = 0;
        $('.x-button').each(function () {
            if ($(this).hasClass('x-button-active')){
                xValue = $(this).find('span').text();
            }
        });
        let x = xValue;
        let y = Number(yStr);
        let r = Number($("#r-value-select").val());
        return (x >= -r / 2 && x <= 0 && y <= r && y >= 0) || (y >= (-x / 2 - r / 2) && y <= 0 && x <= 0) || ((x * x + y * y) <= r * r /4 && x >= 0 && y >= 0);
    };
    const onInpChange = function(){
        let elemY = $("#y-value-select");
        let dotTarget = $("#target-dot");
        let value = Number(elemY.val().replace(",","."));
        if (value < -3 ||  value > 5 || isNaN(value) || /[\s]+/.test(elemY.val()) || elemY.val()===""){
            elemY.removeClass().addClass("is-invalid");
            dotTarget.attr("r", 0);
            $('#menhera').attr("src","resources/invalid.jpg");
            return false;
        } else {
            document.querySelector('#error-log').textContent = " ";
            elemY.removeClass().addClass("is-valid");
            let elemR = $("#r-value-select");
            let xValue = 0;
            $('.x-button').each(function () {
                if ($(this).hasClass('x-button-active')){
                    xValue = $(this).find('span').text();
                }
            });
            console.log(xValue);
            let calculatedX = 2 * (Number(xValue) * 50 / Number(elemR.val())) + 150;
            let calculatedY = -(((Number(elemY.val().replace(",",".")) * 50 * 2) / Number(elemR.val())) - 150);
            dotTarget.attr("r", 3);
            dotTarget.attr("cy", calculatedY);
            dotTarget.attr("cx", calculatedX);
            if (checkArea()){
                $('#menhera').attr("src","resources/correct.jpg");
            } else {
                $('#menhera').attr("src" , "resources/incorrect.jpg");
            }
            return true;
        }
    };
    const submit = function(e) {
        e.preventDefault();
        if (!onInpChange()){
            document.querySelector('#error-log').textContent = "Значение Y должно быть в диапазоне [-3;5]";
            return;
        }
        const formData = new FormData(document.querySelector('#form'));
        let xValue = 0;
        $('.x-button').each(function () {
            if ($(this).hasClass('x-button-active')){
                xValue = $(this).find('span').text();
            }
        });
        formData.append("x_value", xValue);
        fetch('php/check.php', {
            method: 'POST',
            body: formData,
        })
            .then(ans => ans.text())
            .then(table => document.querySelector('#ans').innerHTML=table);
    };
    document.addEventListener('DOMContentLoaded', function(){
        document.querySelector('#submitButton').addEventListener('click', submit);
    });
    const clear = function(e) {
        e.preventDefault();
        fetch('php/clear.php', {
            method: 'POST',
        })
            .then(ans => ans.text())
            .then(table => document.querySelector('#ans').innerHTML=table);
    };
    document.addEventListener('DOMContentLoaded', function(){
        document.querySelector('#clearButton').addEventListener('click', clear);
        $(document).animate("fadeIn");
    });
</script>


<header class="header">
    <div class="container">
        <div class="header_inner">
            <div class="name">
                Лазурин Евгений, R3236
            </div>
            <div class="option">
                Вариант 202022
            </div>
        </div>
    </div>
</header>

<footer class="footer">
    <div class="container">
        <div class="footer_inner">
            <span>  &copy; Лазурин Евгений</span>
        </div>
    </div>
</footer>

<div class="content">
    <div class="svg-container">
        <svg width="300" height="300" class="svg-graph" xmlns="http://www.w3.org/2000/svg">
            <!-- Стрелочки-->
            <line  x1="0" x2="300" y1="150" y2="150" stroke="black"></line>
            <line x1="150" x2="150" y1="0" y2="300" stroke="black"></line>
            <polygon points="150,0 144,15 156,15" stroke="black"></polygon>
            <polygon points="300,150 285,156 285,144" stroke="black"></polygon>

            <!-- Палочки-->
            <line class="coordinate-line" x1="200" x2="200" y1="155" y2="145" stroke="black"></line>
            <line class="coordinate-line" x1="250" x2="250" y1="155" y2="145" stroke="black"></line>

            <line class="coordinate-line" x1="50" x2="50" y1="155" y2="145" stroke="black"></line>
            <line class="coordinate-line" x1="100" x2="100" y1="155" y2="145" stroke="black"></line>

            <line class="coordinate-line" x1="145" x2="155" y1="100" y2="100" stroke="black"></line>
            <line class="coordinate-line" x1="145" x2="155" y1="50" y2="50" stroke="black"></line>

            <line class="coordinate-line" x1="145" x2="155" y1="200" y2="200" stroke="black"></line>
            <line class="coordinate-line" x1="145" x2="155" y1="250" y2="250" stroke="black"></line>

            <!--Буквы-->
            <text class="coordinate-text" x="195" y="140">R/2</text>
            <text class="coordinate-text" x="248" y="140">R</text>

            <text class="coordinate-text" x="40" y="140">-R</text>
            <text class="coordinate-text" x="90" y="140">-R/2</text>

            <text class="coordinate-text" x="160" y="105">R/2</text>
            <text class="coordinate-text" x="160" y="55">R</text>

            <text class="coordinate-text" x="160" y="205">-R/2</text>
            <text class="coordinate-text" x="160" y="255">-R</text>

            <!-- Первая фигура-->
            <polygon class="svg-figure" points="150,150 150,50 250,50 250,150"
                     fill="blue" fill-opacity="0.3" stroke="blue"></polygon>

            <!--Вторая фигура-->
            <path class="svg-figure circle-figure" d="M 150 100 A 50 50, 90, 0, 0, 100 150 L 150 150 Z"
                     fill="green" fill-opacity="0.3" stroke="green"></path>

            <!--Третья фигура-->
            <polygon class="svg-figure" points="200,150 150,150 150,200" fill="red"
                     fill-opacity="0.3" stroke="red"></polygon>

            <circle r="0" cx="150" cy="150" id="target-dot"></circle>
        </svg>
    </div>

    <form class="data-send-form wrapper" id="form" oninput="onInpChange()">
        <div>
            <div class="form-inputs ">

                <div class="group">
                    <input type="text" id="y-value-select" name="y_value" required>
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Y Value:</label>

                    <div class="R"><p><b>R:</b></p>
                        <p><text>1</text><input type="checkbox" id="payt1" name="option1" value="1"><label for="payt1"></label></p>
                        <p><text>2</text><input type="checkbox"  id="payt3" name="option2" value="2"><label for="payt3"></label></p>
                        <p><text>3</text><input type="checkbox" id="payt2" name="option3" value="3"><label for="payt2"></label></p>
                        <p><text>4</text><input type="checkbox" id="payt4" name="option4" value="4"><label for="payt4"></label></p>
                            <p><text>5</text><input type="checkbox" id="payt5" name="option5" value="5"><label for="payt5"></label></p></div>
                </div>


                <div class="x-buttons centered " id="x_value_select">
                    <p style="margin-top: 7px"><strong>X Value: </strong></p>

                    <div class="x-buttons__inner">
                        <p>
                        <div class="x-button"><span>-3</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button"><span>-2</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button"><span>-1</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>

                    </div>

                    <div class="x-buttons__inner">
                        <p>
                        <div class="x-button"><span>1</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button x-button-active"><span>0</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button"><span>2</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>

                    </div>
                    <div class="x-buttons__inner">
                        <p>
                        <div class="x-button"><span>3</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button"><span>4</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>
                        <p>
                        <div class="x-button"><span>5</span>
                            <svg>
                                <polyline class="o1" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                                <polyline class="o2" points="0 0, 50 0, 50 35, 0 35, 0 0"></polyline>
                            </svg>
                        </div>
                        </p>

                    </div>
                </div>


                <div class="form-buttons ">
                    <button class="send-button" type="submit" id="submitButton">Отправить</button>
                    <button class="clear-button" type="button" id="clearButton">Очистить</button>
                </div>

            </div>
            <span id="error-log" style="color: red"> </span>


        </div>
    </form>

</div>




<script>
    $('.x-button').each(function () {
        this.addEventListener('click', function () {
            $('.x-button').each(function () {
                if ($(this).hasClass("x-button-active")){
                    $(this).toggleClass("x-button-active");
                }
            });
            $(this).toggleClass("x-button-active");
            onInpChange();
        })
    })
</script>





</body>
</html>